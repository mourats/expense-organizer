CREATE DATABASE IF NOT EXISTS EXPENSE_ORGANIZER_DB;

DROP TABLE IF EXISTS `DESPESAS`;
DROP TABLE IF EXISTS `USUARIO`;
DROP TABLE IF EXISTS `PERIODO`;
DROP TABLE IF EXISTS `TIPO_PAGAMENTO`;

CREATE TABLE `USUARIO` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `NOME` varchar(45) NOT NULL,
  `SOBRENOME` varchar(45) DEFAULT NULL,
  `EMAIL` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;


CREATE TABLE `PERIODO` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `DATA_INICIO` DATE NOT NULL,
  `DATA_FIM` DATE NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

CREATE TABLE `TIPO_PAGAMENTO` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `NOME` varchar(45) NOT NULL,
  `DIA_VENCIMENTO_PADRAO` TINYINT NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

CREATE TABLE `DESPESAS` (
  `ID` int(11) NOT NULL AUTO_INCREMENT,
  `NOME` varchar(45) NOT NULL,
  `DESCRICAO` varchar(256) DEFAULT NULL,
  `VALOR` decimal(15,2) NOT NULL,
  `PARCELAS` int(11) DEFAULT NULL,
  `KEY_TIPO_PAGAMENTO` int(11) NOT NULL,
  `KEY_PERIODO` int(11) NOT NULL,
  `KEY_USUARIO` int(11) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8;

ALTER TABLE `TIPO_PAGAMENTO` ADD CONSTRAINT `CHECK_DAY` CHECK (DIA_VENCIMENTO_PADRAO >= 1 AND DIA_VENCIMENTO_PADRAO  <= 31);
ALTER TABLE `DESPESAS` ADD CONSTRAINT `FK_TIPO_PAGAMENTO` FOREIGN KEY ( `KEY_TIPO_PAGAMENTO` ) REFERENCES `TIPO_PAGAMENTO` ( `ID` );
ALTER TABLE `DESPESAS` ADD CONSTRAINT `FK_PERIODO` FOREIGN KEY ( `KEY_PERIODO` ) REFERENCES `PERIODO` ( `ID` );
ALTER TABLE `DESPESAS` ADD CONSTRAINT `FK_USUARIO` FOREIGN KEY ( `KEY_USUARIO` ) REFERENCES `USUARIO` ( `ID` );